:PROPERTIES:
:ID:       20251205T140428
:END:
#+title: Nix

Nix has much more packages than Guix. I plan to use it as a version control manager
for Common Lisp, and other languages that lack proper version locking, as well as trying
new languages & staff, so it's important that I can install new packages with ease.

* Installation

#+begin_src bash
# Do not use TUNA, they have huge bandwidth pressure.
sh <(curl -L https://mirrors.bfsu.edu.cn/nix/latest/install) --daemon
# Archlinux has nix package.
sudo pacman -S nix

sudo systemctl enable nix-daemon.socket
cat <<EOF | sudo tee /etc/nix/nix.conf
build-users-group = nixbld

# Use mirror from SJTU & USTC.
substituters = https://mirror.sjtu.edu.cn/nix-channels/store https://mirrors.ustc.edu.cn/nix-channels/store https://cache.nixos.org/ https://nix-community.cachix.org
# See https://nix.dev/manual/nix/2.28/command-ref/conf-file.html#conf-trusted-public-keys.
# See https://app.cachix.org/cache/nix-community.
trusted-public-keys = cache.nixos.org-1:6NCHdD59X431o0gWypbMrAURkbJ16ZPMQFGspcDShjY= nix-community.cachix.org-1:mB9FSh9qf2dCimDSUo8Zy7bkq5CX+/rkCWyvRCYg3Fs=

# Flakes are everywhere, sooner or later we will need to enable it.
experimental-features = nix-command flakes
EOF
sudo systemctl restart nix-daemon.service
# https://nix-community.github.io/home-manager/index.xhtml#_how_do_i_install_packages_from_nixpkgs_unstable
nix-channel --add https://mirrors.ustc.edu.cn/nix-channels/nixpkgs-unstable nixpkgs
nix-channel --update

cat <<EOF >~/.profile.d/99-nix-home-manager.sh
source $HOME/.nix-profile/etc/profile.d/hm-session-vars.sh
EOF
#+end_src


* Home manager

#+begin_src bash
nix-channel --add https://github.com/nix-community/home-manager/archive/master.tar.gz home-manager
nix-channel --update
nix-shell '<home-manager>' -A install
ln -sf ~/pylon/bootstrap/home-manager ~/.config/home-manager
#+end_src

Need to add ~source $HOME/.nix-profile/etc/profile.d/hm-session-vars.sh~ to ~.profile~.

#+begin_src bash
home-manager switch
#+end_src
