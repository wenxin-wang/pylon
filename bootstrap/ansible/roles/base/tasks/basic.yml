---
- name: Add git PPA for Ubuntu
  become: true
  ansible.builtin.apt_repository:
    repo: ppa:git-core/ppa
  when: ansible_facts['distribution'] == 'Ubuntu'

- name: Add eza repo for Ubuntu
  become: true
  block:
    - name: Ensure gpt repo key folder
      ansible.builtin.file:
        path: /etc/apt/keyrings
        mode: '0755'
        state: directory
    - name: Install eza repo key
      ansible.builtin.shell:
        cmd: >-
          wget -qO-
          https://raw.githubusercontent.com/eza-community/eza/main/deb.asc |
          sudo gpg --dearmor -o /etc/apt/keyrings/gierens.gpg
        creates: /etc/apt/keyrings/gierens.gpg
    - name: Ensure eza repo key mode
      ansible.builtin.file:
        path: /etc/apt/keyrings/gierens.gpg
        mode: '0644'
        state: file
    - name: Add eza repo source list
      ansible.builtin.apt_repository:
        repo: >-
          deb [signed-by=/etc/apt/keyrings/gierens.gpg]
          http://deb.gierens.de stable main
        filename: gierens
  when: ansible_facts['distribution'] == 'Ubuntu'

- name: Install basic packages
  become: true
  ansible.builtin.package:
    name:
      - bash-completion
      - eza
      - less
      - git
      - ranger
      - ripgrep
      - tmux
      - unzip
      - vim
      - wget
    state: present

- name: Install basic packages for Archlinux
  when: ansible_facts['distribution'] == 'Archlinux'
  become: true
  ansible.builtin.package:
    name:
      - fd
    state: present

# Ubuntu's fd-find is too old for ~consult-fd~, use nix instead.
# - name: Install basic packages for Debian
#   when: ansible_os_family == "Debian"
#   become: true
#   ansible.builtin.package:
#     name:
#       - fd-find
#     state: present

- name: Setup cron for Archlinux
  when: ansible_facts['distribution'] == 'Archlinux'
  become: true
  block:
    - name: Install cronie
      ansible.builtin.package:
        name:
          - cronie
        state: present

    - name: Enable cronie
      ansible.builtin.service:
        name: cronie
        state: started
        enabled: true

- name: Setup timezone
  when: timezone is defined
  become: true
  community.general.timezone:
    name: "{{ timezone }}"
